<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.ProductDao">
	<insert id="insertProduct" parameterType="Product">
		<selectKey keyProperty="pid" resultType="int" order="BEFORE">
			select seq_product_pid.nextval from dual		
		</selectKey>
		insert into product (
			pid, pcategory, pname, pprice, pnum, pdetail, pattachoname, pattachtype, pattachdata, pdate
		)
		values (
			#{pid}, #{pcategory}, #{pname}, #{pprice}, #{pnum}, #{pdetail}, #{pattachoname}, #{pattachtype}, #{pattachdata}, sysdate
		)
	</insert>
	
	<select id="selectByPid" parameterType="int" resultType="Product">
		select
			pid, pcategory, pname, pprice, pnum, pdetail, pattachoname, pattachtype, pdate
		from product
		where pid = #{value}
	</select>


	<select id="selectByPage"
  		parameterType="Pager"
  		resultType="Product">
  		
  		<![CDATA[ 
  		select rnum, pid, pcategory, pname, pprice, pnum, pdetail, pattachoname, pattachtype, pdate
		
		from (
    		select rownum as rnum, pid, pcategory, pname, pprice, pnum, pdetail, pattachoname, pattachtype, pdate
    		from (
        		select 
				     pid, pcategory, pname, pprice, pnum, pdetail, pattachoname, pattachtype, pdate
				 from product
        		order by pid desc
    			)
    		where rownum <= #{endRowNo}
			)
		where rnum >= #{startRowNo}
  		]]>
  		
  		</select>

			<select id="countAll" resultType="int">
    		select count(*) from product
			</select>


	
	<update id="updateProduct" parameterType="Product">
		update product
		set 
			pcategory = #{pcategory},
			pname = #{pname},
			pprice = #{pprice},
			pnum = #{pnum},
			pdetail = #{pdetail}
			<if test="pattachdata != null">
    		, pattachoname = #{pattachoname}
    		, pattachtype = #{pattachtype}
    		, pattachdata = #{pattachdata}
			</if>
		where pid = #{pid}
	</update>
	
	<delete id="deleteProduct" parameterType="int">
		delete from product
		where pid = #{value}
	</delete>
</mapper>